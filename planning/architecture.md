# Lifely Architecture

> System design for Google Calendar 2025 Wrapped

---

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              LIFELY                                          â”‚
â”‚                    "Flighty, but for your life"                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   Google Calendar  â”€â”€â”€â–¶  Data Pipeline  â”€â”€â”€â–¶  Enrichment  â”€â”€â”€â–¶  Output     â”‚
â”‚                                                                              â”‚
â”‚   â€¢ Fetch events        â€¢ Normalize         â€¢ Locations      â€¢ JSON stats   â”‚
â”‚   â€¢ OAuth auth          â€¢ Friend stats      â€¢ LLM names      â€¢ CLI display  â”‚
â”‚                         â€¢ Time stats        â€¢ Deduplication  â€¢ (UI later)   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## High-Level Architecture

```
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚  Google Cloud   â”‚
                                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                                 â”‚  â”‚ Calendar  â”‚  â”‚
                                 â”‚  â”‚ API       â”‚  â”‚
                                 â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
                                 â”‚        â”‚        â”‚
                                 â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚
                                 â”‚  â”‚ Places    â”‚  â”‚
                                 â”‚  â”‚ API       â”‚  â”‚
                                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                 LIFELY                     â”‚
                    â”‚                                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚       â”‚  â”‚  Auth    â”‚  â”‚  Fetch   â”‚  â”‚ Normalizeâ”‚ â”‚       â”‚  Output  â”‚
â”‚          â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚  â”‚          â”‚â”€â–¶â”‚          â”‚â”€â–¶â”‚          â”‚ â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚          â”‚
â”‚ (CLI)    â”‚       â”‚  â”‚ (OAuth)  â”‚  â”‚ (Cache)  â”‚  â”‚ (Clean)  â”‚ â”‚       â”‚ (JSON)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚        â”‚              â”‚             â”‚      â”‚
                    â”‚        â–¼              â–¼             â–¼      â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚  â”‚  Stats   â”‚  â”‚  LLM     â”‚  â”‚  Places  â”‚ â”‚
                    â”‚  â”‚          â”‚  â”‚ Enrich   â”‚  â”‚  Enrich  â”‚ â”‚
                    â”‚  â”‚ (Agg)    â”‚  â”‚ (Names)  â”‚  â”‚ (Venue)  â”‚ â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â”‚                      â”‚                     â”‚
                    â”‚                      â–¼                     â”‚
                    â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
                    â”‚               â”‚  Dedup   â”‚                 â”‚
                    â”‚               â”‚ (Merge)  â”‚                 â”‚
                    â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                    â”‚                                            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                          â–¼
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚     OpenAI      â”‚
                                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                                 â”‚  â”‚ GPT-4o    â”‚  â”‚
                                 â”‚  â”‚ mini      â”‚  â”‚
                                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DATA FLOW PIPELINE                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 PHASE 1 (Done)                      PHASE 2 (Current)
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•                      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ Calendarâ”‚    â”‚  Raw    â”‚    â”‚Normalizedâ”‚   â”‚ Email   â”‚    â”‚ Final   â”‚
 â”‚  API    â”‚â”€â”€â”€â–¶â”‚ Events  â”‚â”€â”€â”€â–¶â”‚ Events  â”‚â”€â”€â”€â–¶â”‚ Friends â”‚â”€â”€â”€â–¶â”‚ Stats   â”‚
 â”‚         â”‚    â”‚ (JSON)  â”‚    â”‚         â”‚    â”‚         â”‚    â”‚ (JSON)  â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                              â”‚              â–²
                    â”‚                              â”‚              â”‚
                    â–¼                              â–¼              â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
               â”‚  Cache  â”‚                   â”‚ Time    â”‚         â”‚
               â”‚  (disk) â”‚                   â”‚ Stats   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                                                                 â”‚
                                                                 â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
                              â”‚Candidateâ”‚    â”‚ LLM     â”‚         â”‚
                              â”‚ Social  â”‚â”€â”€â”€â–¶â”‚ Extract â”‚         â”‚
                              â”‚ Events  â”‚    â”‚ Names   â”‚         â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â”‚
                                                  â”‚              â”‚
                                                  â–¼              â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
                              â”‚ Dedup & â”‚    â”‚ Merge   â”‚         â”‚
                              â”‚Aggregateâ”‚â”€â”€â”€â–¶â”‚Suggest  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                                                                 â”‚
                                                                 â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
                              â”‚ Places  â”‚    â”‚ Enrich  â”‚         â”‚
                              â”‚  API    â”‚â”€â”€â”€â–¶â”‚ Locationsâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Module Breakdown

### Core Modules (Phase 1)

| Module | File | Responsibility | Input | Output |
|--------|------|----------------|-------|--------|
| **Auth** | `auth.py` | OAuth 2.0 flow, token management | `credentials.json` | Authenticated API service |
| **Fetch** | `fetch.py` | Retrieve calendar events, pagination, caching | API service, year | `list[dict]` raw events |
| **Models** | `models.py` | Data structures for all entities | - | Dataclasses |
| **Normalize** | `normalize.py` | Clean raw API data, timezone handling | Raw events | `list[NormalizedEvent]` |
| **Stats** | `stats.py` | Aggregate by friend, time patterns | Normalized events | `FriendStats`, `TimeStats` |
| **CLI** | `cli.py` | User interface, orchestration | CLI args | Terminal output, JSON file |

### Enrichment Modules (Phase 2)

| Module | File | Responsibility | Input | Output |
|--------|------|----------------|-------|--------|
| **Locations** | `locations.py` | Parse Maps URLs, extract place IDs | Location strings | Place IDs, coordinates |
| **Places Client** | `places_client.py` | Google Places API wrapper, caching | Place IDs | `PlaceDetails` |
| **LLM Enrich** | `llm_enrich.py` | Classify events via GPT-4o-mini (SOCIAL/ACTIVITY/OTHER) | Event summaries | `ClassifiedEvent` list |
| **Dedup** | `dedup.py` | Name normalization, merge suggestions | Extracted names | `InferredFriend`, `MergeSuggestion` |

---

## Data Models

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            DATA MODELS                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 RAW (from API)              NORMALIZED (Phase 1)           ENRICHED (Phase 2)
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•              â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ API Event   â”‚            â”‚ NormalizedEvent â”‚           â”‚ NormalizedEvent â”‚
 â”‚ (dict)      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ + PlaceDetails  â”‚
 â”‚             â”‚            â”‚ â€¢ id            â”‚           â”‚                 â”‚
 â”‚ â€¢ id        â”‚            â”‚ â€¢ summary       â”‚           â”‚ â€¢ venue_name    â”‚
 â”‚ â€¢ summary   â”‚            â”‚ â€¢ start/end     â”‚           â”‚ â€¢ neighborhood  â”‚
 â”‚ â€¢ start     â”‚            â”‚ â€¢ duration_mins â”‚           â”‚ â€¢ cuisine       â”‚
 â”‚ â€¢ end       â”‚            â”‚ â€¢ attendees[]   â”‚           â”‚                 â”‚
 â”‚ â€¢ attendees â”‚            â”‚ â€¢ location_raw  â”‚           â”‚                 â”‚
 â”‚ â€¢ location  â”‚            â”‚                 â”‚           â”‚                 â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                 â”‚
                    â–¼                                 â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ NormalizedAttendeeâ”‚             â”‚ FriendEvent     â”‚
          â”‚                 â”‚               â”‚                 â”‚
          â”‚ â€¢ email         â”‚               â”‚ â€¢ id            â”‚
          â”‚ â€¢ display_name  â”‚               â”‚ â€¢ summary       â”‚
          â”‚ â€¢ is_self       â”‚               â”‚ â€¢ date          â”‚
          â”‚ â€¢ response_statusâ”‚              â”‚ â€¢ hours         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ â€¢ location_raw  â”‚
                                            â”‚ â€¢ venue_name    â”‚
                                            â”‚ â€¢ neighborhood  â”‚
                                            â”‚ â€¢ cuisine       â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


 AGGREGATED STATS                           INFERRED (LLM)
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                           â•â•â•â•â•â•â•â•â•â•â•â•â•â•

 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ FriendStats     â”‚                        â”‚ InferredFriend  â”‚
 â”‚ (email-based)   â”‚                        â”‚ (name-based)    â”‚
 â”‚                 â”‚                        â”‚                 â”‚
 â”‚ â€¢ email         â”‚                        â”‚ â€¢ name          â”‚
 â”‚ â€¢ display_name  â”‚â—„â”€â”€â”€â”€ merge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ â€¢ normalized    â”‚
 â”‚ â€¢ event_count   â”‚      suggestion        â”‚ â€¢ event_count   â”‚
 â”‚ â€¢ total_hours   â”‚                        â”‚ â€¢ total_hours   â”‚
 â”‚ â€¢ events[]      â”‚                        â”‚ â€¢ events[]      â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚ â€¢ linked_email  â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ TimeStats       â”‚                        â”‚ MergeSuggestion â”‚
 â”‚                 â”‚                        â”‚                 â”‚
 â”‚ â€¢ total_events  â”‚                        â”‚ â€¢ inferred_name â”‚
 â”‚ â€¢ total_hours   â”‚                        â”‚ â€¢ suggested_emailâ”‚
 â”‚ â€¢ per_month     â”‚                        â”‚ â€¢ confidence    â”‚
 â”‚ â€¢ per_weekday   â”‚                        â”‚ â€¢ reason        â”‚
 â”‚ â€¢ busiest_day   â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


 ACTIVITY ANALYSIS (LLM)
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ ActivityEvent   â”‚                        â”‚ ActivityCategoryStats   â”‚
 â”‚                 â”‚                        â”‚                         â”‚
 â”‚ â€¢ id            â”‚                        â”‚ â€¢ category (fitness,    â”‚
 â”‚ â€¢ summary       â”‚                        â”‚   wellness, health,     â”‚
 â”‚ â€¢ date          â”‚â”€â”€â”€â”€ aggregate â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   personal_care,        â”‚
 â”‚ â€¢ hours         â”‚                        â”‚   learning, entertain)  â”‚
 â”‚ â€¢ category      â”‚                        â”‚ â€¢ event_count           â”‚
 â”‚ â€¢ activity_type â”‚                        â”‚ â€¢ total_hours           â”‚
 â”‚ â€¢ venue_name    â”‚                        â”‚ â€¢ top_venues[]          â”‚
 â”‚                 â”‚                        â”‚ â€¢ top_activities[]      â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 Categories:
 â€¢ fitness      - gym, yoga, climbing, running, pilates, cycling
 â€¢ wellness     - massage, spa, meditation, acupuncture
 â€¢ health       - doctor, dentist, therapy, physical therapy
 â€¢ personal_care - haircut, nails, facial, waxing
 â€¢ learning     - class, lesson, workshop, tutoring
 â€¢ entertainment - concert, show, movie, museum, game


 LOCATION (Phase 2)
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ PlaceDetails    â”‚      â”‚ VenueStats      â”‚      â”‚ NeighborhoodStatsâ”‚
 â”‚                 â”‚      â”‚                 â”‚      â”‚                 â”‚
 â”‚ â€¢ place_id      â”‚      â”‚ â€¢ place_id      â”‚      â”‚ â€¢ name          â”‚
 â”‚ â€¢ name          â”‚      â”‚ â€¢ name          â”‚      â”‚ â€¢ city          â”‚
 â”‚ â€¢ address       â”‚      â”‚ â€¢ neighborhood  â”‚      â”‚ â€¢ event_count   â”‚
 â”‚ â€¢ neighborhood  â”‚      â”‚ â€¢ cuisine       â”‚      â”‚ â€¢ total_hours   â”‚
 â”‚ â€¢ city/state    â”‚      â”‚ â€¢ visit_count   â”‚      â”‚ â€¢ top_venues    â”‚
 â”‚ â€¢ lat/lng       â”‚      â”‚ â€¢ total_hours   â”‚      â”‚ â€¢ cuisines      â”‚
 â”‚ â€¢ types[]       â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 â”‚ â€¢ primary_type  â”‚
 â”‚ â€¢ price_level   â”‚
 â”‚ â€¢ rating        â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## External Dependencies

### APIs Required

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        EXTERNAL DEPENDENCIES                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           GOOGLE CLOUD                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Service         â”‚ Purpose           â”‚ Auth                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Calendar API    â”‚ Fetch events      â”‚ OAuth 2.0 (credentials.json)          â”‚
â”‚                 â”‚                   â”‚ Scope: calendar.readonly              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Places API (New)â”‚ Location details  â”‚ API Key (GOOGLE_MAPS_API_KEY)         â”‚
â”‚                 â”‚ Venue resolution  â”‚ ~$17/1000 calls                       â”‚
â”‚                 â”‚ Neighborhood data â”‚ Budget: ~$20                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            OPENAI                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Service         â”‚ Purpose           â”‚ Auth                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GPT-4o-mini     â”‚ Classify events:  â”‚ API Key (OPENAI_API_KEY)              â”‚
â”‚                 â”‚ â€¢ SOCIAL â†’ names  â”‚ ~$0.15/1M input tokens                â”‚
â”‚                 â”‚ â€¢ ACTIVITY â†’ type â”‚ Batched: 50 events/request            â”‚
â”‚                 â”‚ â€¢ OTHER â†’ skip    â”‚ JSON mode for structured output       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Environment Variables

```bash
# credentials/credentials.json - OAuth client (downloaded from GCP)
# credentials/token.json       - Auto-generated after first auth

# Phase 2 requirements
GOOGLE_MAPS_API_KEY=your_google_api_key
OPENAI_API_KEY=your_openai_api_key
```

### Python Dependencies

```
Phase 1 (Core):
â”œâ”€â”€ google-api-python-client  # Calendar API client
â”œâ”€â”€ google-auth-oauthlib      # OAuth flow
â”œâ”€â”€ google-auth-httplib2      # HTTP transport
â”œâ”€â”€ python-dateutil           # Date parsing
â””â”€â”€ rich                      # CLI formatting

Phase 2 (Enrichment):
â”œâ”€â”€ openai                    # GPT-4o-mini API client
â”œâ”€â”€ httpx                     # HTTP client for Places API
â””â”€â”€ tenacity                  # Retry logic (optional)
```

---

## File Structure

```
lifely/
â”œâ”€â”€ planning/
â”‚   â”œâ”€â”€ concept.md              # Original vision doc
â”‚   â”œâ”€â”€ phase1-plan.md          # Phase 1 implementation details
â”‚   â”œâ”€â”€ phase2-event-summaries.md  # Event summaries enhancement
â”‚   â”œâ”€â”€ future-phases.md        # Phases 2-5 roadmap
â”‚   â””â”€â”€ architecture.md         # This document
â”‚
â”œâ”€â”€ credentials/                # OAuth credentials (gitignored)
â”‚   â”œâ”€â”€ credentials.json        # Downloaded from GCP
â”‚   â””â”€â”€ token.json              # Auto-generated
â”‚
â”œâ”€â”€ data/                       # Output data (gitignored)
â”‚   â”œâ”€â”€ raw_events_2025.json    # Cached API response
â”‚   â”œâ”€â”€ stats_2025.json         # Computed statistics
â”‚   â””â”€â”€ places_cache.json       # Places API cache (Phase 2)
â”‚
â”œâ”€â”€ src/lifely/
â”‚   â”‚
â”‚   â”‚  # â•â•â•â•â•â• PHASE 1 (Done) â•â•â•â•â•â•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ auth.py                 # OAuth authentication
â”‚   â”œâ”€â”€ fetch.py                # Calendar API fetching
â”‚   â”œâ”€â”€ models.py               # All data models
â”‚   â”œâ”€â”€ normalize.py            # Event normalization
â”‚   â”œâ”€â”€ stats.py                # Statistics computation
â”‚   â”œâ”€â”€ cli.py                  # CLI entrypoint
â”‚   â”‚
â”‚   â”‚  # â•â•â•â•â•â• PHASE 2 (Current) â•â•â•â•â•â•
â”‚   â”œâ”€â”€ locations.py            # Maps URL parsing
â”‚   â”œâ”€â”€ places_client.py        # Places API wrapper
â”‚   â”œâ”€â”€ llm_enrich.py           # LLM friend extraction
â”‚   â””â”€â”€ dedup.py                # Name deduplication
â”‚
â”œâ”€â”€ tests/                      # Test files
â”œâ”€â”€ pyproject.toml              # Project config
â”œâ”€â”€ .env.example                # Environment template
â””â”€â”€ README.md                   # Setup instructions
```

---

## Processing Pipeline Detail

### Step-by-Step Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PROCESSING PIPELINE                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 1: AUTHENTICATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ credentials/ â”‚     â”‚   OAuth      â”‚     â”‚  Authenticatedâ”‚
â”‚ credentials  â”‚â”€â”€â”€â”€â–¶â”‚   Flow       â”‚â”€â”€â”€â”€â–¶â”‚  Service      â”‚
â”‚ .json        â”‚     â”‚ (browser)    â”‚     â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ credentials/ â”‚
                     â”‚ token.json   â”‚
                     â”‚ (cached)     â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP 2: FETCH EVENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Calendar    â”‚     â”‚  Paginate    â”‚     â”‚ raw_events_  â”‚
â”‚  API         â”‚â”€â”€â”€â”€â–¶â”‚  (2500/page) â”‚â”€â”€â”€â”€â–¶â”‚ 2025.json    â”‚
â”‚              â”‚     â”‚              â”‚     â”‚ (cached)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Parameters:
       â”‚ â€¢ timeMin: 2025-01-01
       â”‚ â€¢ timeMax: 2026-01-01
       â”‚ â€¢ singleEvents: true
       â”‚ â€¢ orderBy: startTime
       â”‚
       â–¼


STEP 3: NORMALIZE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Raw Events  â”‚     â”‚  For each:   â”‚     â”‚ Normalized   â”‚
â”‚  (dict[])    â”‚â”€â”€â”€â”€â–¶â”‚  â€¢ Parse TZ  â”‚â”€â”€â”€â”€â–¶â”‚ Events       â”‚
â”‚              â”‚     â”‚  â€¢ Calc dur  â”‚     â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â€¢ Clean att â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚  â€¢ Detect selfâ”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP 4: COMPUTE STATS (Email-based)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Normalized   â”‚     â”‚  Group by:   â”‚     â”‚ FriendStats  â”‚
â”‚ Events       â”‚â”€â”€â”€â”€â–¶â”‚  â€¢ Attendee  â”‚â”€â”€â”€â”€â–¶â”‚ (email-based)â”‚
â”‚              â”‚     â”‚  â€¢ Filter sysâ”‚     â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â€¢ Sum hours â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
       â”‚                                         â”‚
       â–¼                                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚ TimeStats    â”‚                                 â”‚
â”‚ â€¢ per month  â”‚                                 â”‚
â”‚ â€¢ per weekdayâ”‚                                 â”‚
â”‚ â€¢ busiest dayâ”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
                                                 â”‚
                                                 â”‚
STEP 5: COLLECT CANDIDATES (Solo events)         â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ Normalized   â”‚     â”‚  Filter:     â”‚            â”‚
â”‚ Events       â”‚â”€â”€â”€â”€â–¶â”‚  â€¢ No attend â”‚            â”‚
â”‚              â”‚     â”‚  â€¢ Has summaryâ”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â€¢ Not "gym" â”‚            â”‚
                     â”‚    "flight"  â”‚            â”‚
                     â”‚    etc.      â”‚            â”‚
                     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
                            â”‚                    â”‚
                            â–¼                    â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
                     â”‚ Candidate    â”‚            â”‚
                     â”‚ Social Eventsâ”‚            â”‚
                     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
                            â”‚                    â”‚
                            â”‚                    â”‚
STEP 6: LLM CLASSIFICATION   â”‚                    â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚                    â”‚
                            â–¼                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  OpenAI      â”‚     â”‚  Classify:   â”‚            â”‚
â”‚  GPT-4o-mini â”‚â”€â”€â”€â”€â–¶â”‚  SOCIAL/     â”‚            â”‚
â”‚              â”‚     â”‚  ACTIVITY/   â”‚            â”‚
â”‚              â”‚     â”‚  OTHER       â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
                            â”‚                    â”‚
                            â”‚                    â”‚
STEP 7: DEDUPLICATE          â”‚                    â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•          â”‚                    â”‚
                            â–¼                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ (event,names)â”‚     â”‚  Normalize:  â”‚            â”‚
â”‚  pairs       â”‚â”€â”€â”€â”€â–¶â”‚  â€¢ lowercase â”‚            â”‚
â”‚              â”‚     â”‚  â€¢ aggregate â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
                            â”‚                    â”‚
                            â–¼                    â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
                     â”‚ Inferred     â”‚            â”‚
                     â”‚ Friends      â”‚            â”‚
                     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
                            â”‚                    â”‚
                            â”‚                    â”‚
STEP 8: MERGE SUGGESTIONS    â”‚                    â”‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚                    â”‚
                            â–¼                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ Inferred     â”‚     â”‚  Match:      â”‚            â”‚
â”‚ Friends      â”‚â”€â”€â”€â”€â–¶â”‚  â€¢ name in   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚              â”‚     â”‚    email     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â€¢ display   â”‚
                     â”‚    name      â”‚
                     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ Merge        â”‚
                     â”‚ Suggestions  â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP 9: LOCATION ENRICHMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FriendStats  â”‚     â”‚  For each    â”‚     â”‚ Enriched     â”‚
â”‚ + Inferred   â”‚â”€â”€â”€â”€â–¶â”‚  location:   â”‚â”€â”€â”€â”€â–¶â”‚ Stats        â”‚
â”‚              â”‚     â”‚  â€¢ Parse URL â”‚     â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â€¢ Places APIâ”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚  â€¢ Cache hit?â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP 10: OUTPUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ All Stats    â”‚     â”‚  Serialize   â”‚     â”‚ stats_2025   â”‚
â”‚              â”‚â”€â”€â”€â”€â–¶â”‚  to JSON     â”‚â”€â”€â”€â”€â–¶â”‚ .json        â”‚
â”‚              â”‚     â”‚              â”‚     â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLI Display  â”‚
â”‚ (rich table) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Output Schema

### Final JSON Structure (Phase 2)

```json
{
  "year": 2025,
  "generated_at": "2025-12-10T15:30:00Z",

  "time_stats": {
    "total_events": 392,
    "total_hours": 1807.9,
    "events_per_month": {"1": 37, "2": 21, ...},
    "hours_per_month": {"1": 117.3, ...},
    "events_per_weekday": {"Mon": 46, "Tue": 36, ...},
    "busiest_day": ["2025-06-14", 12, 152.4]
  },

  "friend_stats": [
    {
      "email": "friend@example.com",
      "display_name": "Friend Name",
      "event_count": 4,
      "total_hours": 8.8,
      "events": [
        {
          "id": "abc123",
          "summary": "Dinner",
          "date": "2025-03-15",
          "hours": 2.5,
          "location_raw": "Thai Villa, Brooklyn",
          "venue_name": "Thai Villa",
          "neighborhood": "Williamsburg",
          "cuisine": "Thai"
        }
      ]
    }
  ],

  "inferred_friends": [
    {
      "name": "Masha",
      "normalized_name": "masha",
      "event_count": 3,
      "total_hours": 6.5,
      "linked_email": null,
      "events": [...]
    }
  ],

  "merge_suggestions": [
    {
      "inferred_name": "Masha",
      "suggested_email": "masha.k@gmail.com",
      "confidence": "high",
      "reason": "'Masha' matches email prefix"
    }
  ],

  "activity_stats": {
    "fitness": {
      "category": "fitness",
      "event_count": 45,
      "total_hours": 67.5,
      "top_venues": [["Vital Climbing", 15], ["Equinox", 12]],
      "top_activities": [["yoga", 20], ["climbing", 15], ["gym", 10]]
    },
    "wellness": {
      "category": "wellness",
      "event_count": 12,
      "total_hours": 18.0,
      "top_venues": [["Aire Ancient Baths", 5]],
      "top_activities": [["massage", 6], ["meditation", 4]]
    },
    "health": {...},
    "personal_care": {...},
    "learning": {...},
    "entertainment": {...}
  },

  "location_stats": {
    "top_venues": [...],
    "top_neighborhoods": [...],
    "top_cuisines": [...]
  }
}
```

---

## Phase Roadmap

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           PHASE ROADMAP                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 PHASE 1 âœ…                PHASE 2 ğŸ”„               PHASE 3                PHASE 4
 Calendar Pipeline         Location + LLM           Full Stats + Prompt    Visual UI
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•        â•â•â•â•â•â•â•â•â•â•â•â•â•â•           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â•â•â•â•â•â•â•â•â•

 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ â€¢ OAuth auth    â”‚      â”‚ â€¢ Places API    â”‚      â”‚ â€¢ Context tags  â”‚    â”‚ â€¢ HTML/CSS      â”‚
 â”‚ â€¢ Fetch events  â”‚      â”‚ â€¢ URL parsing   â”‚      â”‚ â€¢ YearSummary   â”‚    â”‚ â€¢ Flighty-style â”‚
 â”‚ â€¢ Normalize     â”‚ â”€â”€â”€â–¶ â”‚ â€¢ LLM classify  â”‚ â”€â”€â”€â–¶ â”‚ â€¢ LLM prompt    â”‚â”€â”€â”€â–¶â”‚ â€¢ Charts/maps   â”‚
 â”‚ â€¢ Email friends â”‚      â”‚ â€¢ Friend extractâ”‚      â”‚ â€¢ Narrative gen â”‚    â”‚ â€¢ Shareable     â”‚
 â”‚ â€¢ Time stats    â”‚      â”‚ â€¢ Activity statsâ”‚      â”‚                 â”‚    â”‚                 â”‚
 â”‚ â€¢ JSON output   â”‚      â”‚ â€¢ Deduplication â”‚      â”‚                 â”‚    â”‚                 â”‚
 â”‚ â€¢ CLI display   â”‚      â”‚ â€¢ Merge suggest â”‚      â”‚                 â”‚    â”‚                 â”‚
 â”‚                 â”‚      â”‚ â€¢ Neighborhoods â”‚      â”‚                 â”‚    â”‚                 â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 Dependencies:             Dependencies:            Dependencies:          Dependencies:
 â€¢ Calendar API           â€¢ Phase 1 complete       â€¢ Phase 2 complete     â€¢ Phase 3 complete
 â€¢ OAuth credentials      â€¢ Places API key         â€¢ All stats computed   â€¢ Static HTML gen
                          â€¢ OpenAI API key                                â€¢ Tailwind CSS
                                                                          â€¢ Chart.js
```

---

## Caching Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          CACHING STRATEGY                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 LAYER 1: Calendar Events
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 File: data/raw_events_{year}.json
 Key: year
 TTL: Manual refresh (--no-cache flag)
 Size: ~1-5 MB typical

 LAYER 2: Places API Responses
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 File: data/places_cache.json
 Key: place_id OR normalized location string
 TTL: Indefinite (place details rarely change)
 Size: ~100-500 KB typical

 LAYER 3: LLM Extractions
 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 File: data/llm_cache.json
 Key: hash(event_summary)
 TTL: Indefinite (same summary = same extraction)
 Size: ~50-200 KB typical


 Cache Flow:
 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

 Request â”€â”€â”€â–¶ Check Cache â”€â”€â”€â–¶ HIT â”€â”€â”€â–¶ Return cached
                   â”‚
                   â”‚ MISS
                   â–¼
              Call API â”€â”€â”€â–¶ Store in cache â”€â”€â”€â–¶ Return fresh
```

---

## Error Handling

| Error | Source | Handling |
|-------|--------|----------|
| OAuth expired | Calendar API | Auto-refresh token, re-auth if needed |
| Rate limited | Places API | Exponential backoff, respect 429 |
| Invalid location | Places API | Skip, log warning, continue |
| LLM timeout | OpenAI API | Retry with backoff, fallback to skip |
| Parse failure | LLM response | Log error, skip event, continue |
| Network error | Any API | Retry 3x, then fail gracefully |

---

## Security Considerations

| Asset | Protection |
|-------|------------|
| `credentials.json` | Gitignored, never commit |
| `token.json` | Gitignored, user-specific |
| API keys | Environment variables, never in code |
| Calendar data | Local only, gitignored |
| Friend emails | Local only, not uploaded anywhere |

---

## Performance Targets

| Operation | Target | Notes |
|-----------|--------|-------|
| Full year fetch | < 30s | Cached after first run |
| Stats computation | < 5s | In-memory processing |
| LLM extraction | < 60s | Batched, 50 events/request |
| Places enrichment | < 120s | Cached after first run |
| Total (cached) | < 10s | Most data from disk |
| Total (fresh) | < 5min | First run with all APIs |
